<yatt:my backend:value="&yatt:cc_sessions();"/>

<ul>
<yatt:foreach my=project list="&yatt:backend:project_list();">
  <h2>&yatt:project;</h2>
  <ul>
    <yatt:foreach my=session list="&yatt:backend:session_list(:project);">
      <li><a href="?~~=session;id=&yatt:session{id};">&yatt:session{id};</a></li>
    </yatt:foreach>
  </ul>
</yatt:foreach>

&yatt:backend{_id_cache};

</ul>

<!yatt:page session id>

<yatt:my backend:value="&yatt:cc_sessions();"
         items:list="&yatt:backend:scan_session(:id);"/>

<a href="./">Top</a>

<style>
  .session-item { margin: 5px 0; padding: 5px; border-left: 3px solid #ccc; }
  .session-user { border-left-color: #4CAF50; }
  .session-assistant { border-left-color: #2196F3; }
  .session-tool_use { border-left-color: #FF9800; }
  .session-tool_result { border-left-color: #9C27B0; }
  .session-summary { color: #666; font-size: 0.9em; margin-left: 20px; }
</style>

<ul>
  <yatt:foreach my=item list=items nth=i>
    <yatt:my ix:value="&yatt:i; - 1"/>
    <li class="session-item session-&yatt:item{type};">
      <a href="./?~~=show;id=&yatt:id;;ix=&yatt:ix;">
        <strong>&yatt:ix;:</strong> 
        <yatt:if "&yatt:item{type}; eq 'user'">ğŸ‘¤ User
        <:yatt:else if="&yatt:item{type}; eq 'assistant'"/>ğŸ¤– Claude
        <:yatt:else if="&yatt:item{type}; eq 'tool_use'"/>ğŸ”§ &yatt:item{tool};
        <:yatt:else if="&yatt:item{type}; eq 'tool_result'"/>ğŸ“Š Result
        <:yatt:else/>&yatt:item{type};
        </yatt:if>
      </a>
      <div class="session-summary">&yatt:item{summary};</div>
    </li>
  </yatt:foreach>
</ul>


<!yatt:page show id ix>

<yatt:my backend:value="&yatt:cc_sessions();"
         json="&yatt:backend:read_session_item(:id,:ix);"
         rec:value="&yatt:decode_json(:json);"
         prev_ix:value="&yatt:ix; - 1"
         next_ix:value="&yatt:ix; + 1"
         />

<style>
  pre.content, pre.json {
      white-space: pre-wrap;
  }
</style>

<a href="./?~~=show;id=&yatt:id;;ix=&yatt:prev_ix;">â†</a>
<a href="?~~=session;id=&yatt:id;">â†‘</a>
<a href="./?~~=show;id=&yatt:id;;ix=&yatt:next_ix;">â†’</a><br>

<h3>&yatt:rec{type};</h3>

<yatt:if "ref &yatt:rec{message}{content}; eq 'ARRAY'">
  <yatt:foreach my:value=item list="&yatt:lexpand(:rec{message}{content});" >
    <yatt:if "&yatt:can_render([content_type_,:item{type}]);">
      &yatt:render([content_type_,:item{type}],:item);
      <:yatt:else/>
      <h3>&yatt:item{type};</h3>
      <pre class="content">&yatt:item;</pre>
    </yatt:if>
  </yatt:foreach>
<:yatt:else/>
<pre class="content">
&yatt:rec{message}{content};
</pre>
</yatt:if>
<yatt:my result:value="&yatt:rec{toolUseResult};"/>
<yatt:if "ref &yatt:result;">
  &yatt:result{filePath};<br>
  oldString
  <pre>&yatt:result{oldString};</pre>
  newString
  <pre>&yatt:result{newString};</pre>
<:yatt:else/>
no toolUseResult result
</yatt:if>
<hr>
<pre class="json">
&yatt:decode_utf8(:json);
</pre>

<script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked-highlight/lib/index.umd.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/styles/default.min.css">
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/highlight.min.js"></script>

<script>
  const { Marked } = globalThis.marked;
  const { markedHighlight } = globalThis.markedHighlight;
  const marked = new Marked(
    markedHighlight({
      emptyLangClass: 'hljs',
      langPrefix: 'hljs language-',
      highlight(code, lang, info) {
        const language = hljs.getLanguage(lang) ? lang : 'plaintext';
        return hljs.highlight(code, { language }).value;
      }
    })
  );
  for (const node of document.querySelectorAll('.content')) {
    node.innerHTML = marked.parse(node.textContent);
  }
  hljs.highlightAll();
</script>

<!yatt:entity decode_json json>
use JSON;
decode_json($json);

<!yatt:entity decode_utf8 str>
use Encode;
decode_utf8($str);

<!yatt:widget content_type__text item="value!">

<pre class="content">
&yatt:item{text};
</pre>


<!yatt:widget content_type__tool_result item="value!">

<h3>&yatt:item{type};</h3>

<pre class="content">&yatt:item{content};</pre>


<!yatt:widget content_type__tool_use item="value!">

<h3>&yatt:item{type};: &yatt:item{name};</h3>

<yatt:if "&yatt:can_render([tool_use_,:item{name}]);">
  &yatt:render([tool_use_,:item{name}],:item);
  <:yatt:else/>
  (No special widget)
  <pre class="content">&yatt:item;</pre>
</yatt:if>


<!yatt:widget tool_use__Edit item="value!">

<h4>input: new_string</h4>
&yatt:item{input}{file_path};
<yatt:if "&yatt:item{input}{file_path}; =~ /\.(t|pl|pm)$/">
<pre><code class="language-perl">&yatt:item{input}{new_string};</code></pre>
<:yatt:else/>
<pre class="content">&yatt:item{input}{new_string};</pre>
</yatt:if>

<!yatt:widget tool_use__TodoWrite item="value!">

<h4>input: todos</h4>
<ul>
<yatt:foreach my=todo list="&yatt:lexpand(:item{input}{todos});">
  <li>&yatt:todo{id}; &yatt:todo{status}; &yatt:todo{content};</li>
</yatt:foreach>
</ul>


<!yatt:widget tool_use__Bash item="value!">

<p>
  &yatt:item{input}{description};
</p>
<pre><code class="language-sh">&yatt:item{input}{command};</code></pre>
